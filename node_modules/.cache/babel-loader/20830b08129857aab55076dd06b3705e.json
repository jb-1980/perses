{"ast":null,"code":"import _defineProperty from \"/home/joseph/projects/perses/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _objectSpread from \"/home/joseph/projects/perses/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";\nimport _slicedToArray from \"/home/joseph/projects/perses/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/home/joseph/projects/perses/src/contexts/renderer-context.tsx\";\nimport React from \"react\";\nimport { Renderers } from \"../widgets\";\nvar Context = React.createContext({});\n\nvar RendererContextProvider = function RendererContextProvider(_ref) {\n  var itemData = _ref.itemData,\n      children = _ref.children;\n  var transformedWidgets = Object.entries(itemData.question.widgets).reduce(function (acc, _ref2) {\n    var _ref3 = _slicedToArray(_ref2, 2),\n        widgetId = _ref3[0],\n        widget = _ref3[1];\n\n    var widgetRenderer = Renderers.find(function (w) {\n      return w.type === widget.type;\n    });\n\n    if (!widgetRenderer) {\n      throw Error(\"There is no widget of type \".concat(widget === null || widget === void 0 ? void 0 : widget.type, \". Was the renderer exported from widgets?\"));\n    }\n\n    var transform = widgetRenderer.transform,\n        grade = widgetRenderer.grade;\n    acc[widgetId] = _objectSpread({}, widget, {\n      grade: grade,\n      options: transform(widget.options)\n    });\n    return acc;\n  }, {});\n\n  var _React$useState = React.useState(_objectSpread({}, itemData.question, {\n    widgets: transformedWidgets\n  })),\n      _React$useState2 = _slicedToArray(_React$useState, 2),\n      question = _React$useState2[0],\n      setQuestion = _React$useState2[1];\n\n  var hints = itemData.hints;\n\n  var setWidgetProps = function setWidgetProps(widgetId, newProps) {\n    var widget = question.widgets[widgetId];\n    setQuestion(_objectSpread({}, question, {\n      widgets: _objectSpread({}, question.widgets, _defineProperty({}, widgetId, _objectSpread({}, widget, {\n        options: newProps\n      })))\n    }));\n  };\n\n  var calculateGrade = function calculateGrade() {\n    var userWidgets = question.widgets;\n    var itemWidgets = itemData.question.widgets;\n    var iterable = Object.entries(userWidgets);\n\n    for (var i = 0; i < iterable.length; i += 1) {\n      var _iterable$i = _slicedToArray(iterable[i], 2),\n          _widgetId = _iterable$i[0],\n          widget = _iterable$i[1];\n\n      var grade = widget.grade,\n          props = widget.options;\n      var options = itemWidgets[_widgetId].options;\n      if (!grade(props, options)) return false;\n    }\n\n    return true;\n  };\n\n  return React.createElement(Context.Provider, {\n    value: {\n      hints: hints,\n      question: question,\n      setWidgetProps: setWidgetProps,\n      calculateGrade: calculateGrade\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 77\n    },\n    __self: this\n  }, children);\n};\n\nvar useRendererContext = function useRendererContext() {\n  var renderer = React.useContext(Context);\n\n  if (renderer === undefined) {\n    throw new Error(\"useRendereContext must be used within a <RendererContextProvider>\");\n  }\n\n  return renderer;\n};\n\nexport { RendererContextProvider, useRendererContext };","map":{"version":3,"sources":["/home/joseph/projects/perses/src/contexts/renderer-context.tsx"],"names":["React","Renderers","Context","createContext","RendererContextProvider","itemData","children","transformedWidgets","Object","entries","question","widgets","reduce","acc","widgetId","widget","widgetRenderer","find","w","type","Error","transform","grade","options","useState","setQuestion","hints","setWidgetProps","newProps","calculateGrade","userWidgets","itemWidgets","iterable","i","length","props","useRendererContext","renderer","useContext","undefined"],"mappings":"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","sourcesContent":["import React from \"react\"\nimport { Renderers } from \"../widgets\"\n\ntype questionType = {\n  content: string\n  images: {}\n  widgets: { [key: string]: any }\n}\n\ntype contextType = {\n  hints: {}\n  question: questionType\n  setWidgetProps: (widgetId: string, newProps: {}) => void\n  calculateGrade: () => boolean\n}\nconst Context = React.createContext<Partial<contextType>>({})\n\ntype contextProps = {\n  itemData: {\n    question: questionType\n    hints: {}\n  }\n  children: any\n}\n\nconst RendererContextProvider = ({ itemData, children }: contextProps) => {\n  const transformedWidgets = Object.entries(itemData.question.widgets).reduce(\n    (acc: { [key: string]: {} }, [widgetId, widget]) => {\n      const widgetRenderer = Renderers.find(w => w.type === widget.type)\n      if (!widgetRenderer) {\n        throw Error(\n          `There is no widget of type ${widget?.type}. Was the renderer exported from widgets?`\n        )\n      }\n\n      const { transform, grade } = widgetRenderer\n      acc[widgetId] = { ...widget, grade, options: transform(widget.options) }\n      return acc\n    },\n    {}\n  )\n\n  const [question, setQuestion] = React.useState({\n    ...itemData.question,\n    widgets: transformedWidgets,\n  })\n  const { hints } = itemData\n\n  const setWidgetProps = (widgetId: string, newProps: {}) => {\n    const widget = question.widgets[widgetId]\n    setQuestion({\n      ...question,\n      widgets: {\n        ...question.widgets,\n        [widgetId]: { ...widget, options: newProps },\n      },\n    })\n  }\n\n  const calculateGrade = () => {\n    const { widgets: userWidgets } = question\n    const { widgets: itemWidgets } = itemData.question\n\n    const iterable = Object.entries(userWidgets)\n\n    for (let i = 0; i < iterable.length; i += 1) {\n      let [widgetId, widget] = iterable[i]\n      let { grade, options: props } = widget\n      let { options } = itemWidgets[widgetId]\n      if (!grade(props, options)) return false\n    }\n\n    return true\n  }\n\n  return (\n    <Context.Provider\n      value={{ hints, question, setWidgetProps, calculateGrade }}\n    >\n      {children}\n    </Context.Provider>\n  )\n}\n\nconst useRendererContext = () => {\n  const renderer = React.useContext(Context)\n\n  if (renderer === undefined) {\n    throw new Error(\n      \"useRendereContext must be used within a <RendererContextProvider>\"\n    )\n  }\n\n  return renderer\n}\n\nexport { RendererContextProvider, useRendererContext }\n"]},"metadata":{},"sourceType":"module"}